pr:
  - main

resources:
    repositories:
        - repository: 1esPipelines
          type: git
          name: 1ESPipelineTemplates/1ESPipelineTemplates
          ref: refs/tags/release
        - repository: self

variables:
  BuildConfiguration: 'Release'
  OutputArtifactName: 'SBOMTool'

extends:
  template: v1/1ES.Unofficial.PipelineTemplate.yml@1esPipelines
  parameters:
    sdl:
      sourceAnalysisPool:
        name: sbom-windows-build-pool
        os: windows
    settings:
      skipBuildTagsForGitHubPullRequests: true
    stages:
      - stage: stage1
        jobs:
        - job: Job_1
          displayName: Build (Windows)
          templateContext:
            outputs:
            - output: pipelineArtifact
              targetPath: $(Build.ArtifactStagingDirectory)
              artifactName: '$(OutputArtifactName)'
          pool:
            name: sbom-windows-build-pool
            os: windows
          steps:
          - template: pipelines/build-test-tool-template.yaml@self

        - job: Job_2
          displayName: 'Build (Linux)'
          templateContext:
            outputs:
            - output: pipelineArtifact
              targetPath: $(Build.ArtifactStagingDirectory)
              artifactName: '$(OutputArtifactName)'
          pool:
            name: sbom-linux-build-pool
            os: linux
          steps:
          - template: pipelines/build-test-tool-template.yaml@self

        - job: Job_3
          displayName: 'Build (macOS)'
          templateContext:
            outputs:
            - output: pipelineArtifact
              targetPath: $(Build.ArtifactStagingDirectory)
              artifactName: '$(OutputArtifactName)'
          pool:
            name: Azure Pipelines
            image: macos-latest
            os: macOS
          steps:
          - template: pipelines/build-test-tool-template.yaml@self

        - job: Job_4
          displayName: 'Build (macOS-arm64)'
          templateContext:
            outputs:
            - output: pipelineArtifact
              targetPath: $(Build.ArtifactStagingDirectory)
              artifactName: '$(OutputArtifactName)'
          pool:
            name: Azure Pipelines
            image: macos-latest
            os: macOS
          steps:
          - template: pipelines/build-test-tool-template.yaml@self
