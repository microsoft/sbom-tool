steps:
  - task: UseDotNet@2
    displayName: 'Use .NET Core'
    inputs:
      useGlobalJson: true

  - task: DotNetCoreCLI@2
    displayName: 'Restore solution'
    inputs:
      command: restore
      feedsToUse: config
      nugetConfigPath: nuget.config
      verbosityRestore: Normal

  - task: DotNetCoreCLI@2
    displayName: Build
    inputs:
      arguments: '-c $(BuildConfiguration)'

  - task: DotNetCoreCLI@2
    displayName: Run unit tests (with coverage on Windows)
    condition: eq(variables['Agent.OS'], 'Windows_NT')
    inputs:
      command: 'test'
      nobuild: true
      configuration: '$(BuildConfiguration)'
      arguments: '-- --report-trx --results-directory $(Agent.TempDirectory) --coverage --coverage-output $(Agent.TempDirectory)/coverage.cobertura.xml --coverage-output-format cobertura'

  - task: DotNetCoreCLI@2
    displayName: Run unit tests (without coverage on non-Windows)
    condition: ne(variables['Agent.OS'], 'Windows_NT')
    inputs:
      command: 'test'
      nobuild: true
      configuration: '$(BuildConfiguration)'
      arguments: '-- --report-trx --results-directory $(Agent.TempDirectory)'
